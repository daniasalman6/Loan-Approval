---
title: "Data Science Project - Loan Approval"
author: "Alex Biuckians, Armin Soroosh, Dania Salman, Kaipu Liu"
bibliography: references.bib
csl: ieee.csl 
link-citations: true 
output:
  html_document:
    code_folding: hide
    number_sections: false
    theme: journal
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
library(ezids)
library(dplyr) 
library(tidyr)
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results="hide", message = F)
#knitr::opts_chunk$set(warning = F, message = F)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
```
## Abstract
With increasing economic challenges and daily financial demands, the demand for loans continues to rise. Financial institutions receive a large number of loan applications each day, making it difficult to manage them, particularly when evaluations are done manually and there are no reliable methods to assess a candidate’s creditworthiness [@Mnkandla2024Loan]. To simplify the process for both applicants and financial institutions, it is essential to develop robust evaluation methods that can accurately predict a loan applicant’s creditworthiness while minimizing risks for lenders. To achieve this, we have decided to explore an existing dataset to identify patterns across various features of loan applicants and determine which factors have the greatest impact on loan approvals. Once these key features are identified, predictive models can be built around them, reducing the need for manual evaluation and enabling data-driven decision-making based on actual application data.

## Introduction
To investigate the factors that influence loan decisions, we obtained a dataset from Kaggle [@sharma2023loan] containing various variables for each loan application, such as income, education, CIBIL score, and the final loan status (Approved or Rejected). Our goal is to examine whether each of these variables has any impact on the loan decision. We have formulated around 10 smart questions that explore the potential effect of each variable on the final outcome. The insights gained from this exploratory analysis will guide the development of predictive models capable of accurately determining whether a loan should be approved for a given applicant.

### Loading the Dataset
```{r read_dataset, echo=TRUE}
# reading dataset
loan_df <- data.frame(read.csv("loan_approval_dataset.csv"))
```

```{r explore_dataset, echo=TRUE}
# exploring dataset
str(loan_df)
```
The dataset has **4269 observations** with **13 variables**

## Data Cleaning & Summary

### subsetting data and converting categorical variables to factor
Removing `loan_id` column since it only serves as a unique identifier and does not contribute to the analysis. Furthermore, converting several numeric variables into factors, as they represent categorical information rather than continuous numerical values.
```{r data_cleaning, echo=TRUE}
loan_df <- subset(loan_df, select = -c(loan_id))

# converting the numeric variables to factor variables
loan_df$no_of_dependents = as.factor(loan_df$no_of_dependents)
loan_df$education = as.factor(loan_df$education)
loan_df$self_employed = as.factor(loan_df$self_employed)
loan_df$loan_status = as.factor(loan_df$loan_status)
str(loan_df)
```
After conversion, we have the following variables in the dataset:

#### Variables in dataset
```{r echo=TRUE, results='markup'}
library(knitr)

# Sample data frame
loan_data <- data.frame(
  Variable = c("no_of_dependents", "education", "self_employed", "income_annum", "loan_amount", "loan_term", "cibil_score", "residential_assets_value", "commercial_assets_value", "luxury_assets_value", "bank_asset_value", "loan_status"),
  Description = c("Number of dependents an applicant has ranging from 0 to 5", "Education level (Graduate or Not Graduate)", "Whether the applicant works independently or for an employer", "Annual income of applicant", "Amount of loan requested", "The number of years in which the applicant will repay the loan","Credit score indicating applicants history of repayment", "Value of applicant's residential assets if any", "Value of applicant's commercial assets if any", "Value of applicant's luxury assets if any", "Value of applicant's bank assets if any", "Target variable indicating whether the loan was Approved or Rejected"),
  Type = c("Categorical", "Categorical", "Categorical", "Numeric", "Numeric", "Numeric", "Numeric", "Numeric", "Numeric", "Numeric", "Numeric", "Categorical")
)

# Create table
kable(loan_data)
```

### Finding NA values
```{r, echo=TRUE}
sum(is.na(loan_df))
```
There are no NA values in the data set

### Summary of the dataset
```{r echo=TRUE}
summary(loan_df)
```
Overall, the dataset appears well-structured and balanced. **Categorical variables** such as `education`, `self_employment`, and `loan_status` show nearly **even distributions** across their categories. Most **numerical variables** fall within reasonable ranges, with average loan terms around `11 years` and CIBIL scores centered near `600`, both indicating realistic applicant profiles. However, some financial variables like income, loan amount, and asset values show wide variation and possible outliers. In particular, the presence of negative values in `residential_assets_value` points to potential data quality issues that will need correction before exploration or testing.

### Cleaning up negative values
Checking the number of rows that have negative values for `residential_assets_value` column
```{r echo=TRUE}
sum(loan_df$residential_assets_value < 0)
```
There are `28` entries with negative values.

### Removing entries with negative values
```{r echo=TRUE}
loan_df <- loan_df[loan_df$residential_assets_value >= 0, ]
str(loan_df)
summary(loan_df)
```
After filtering out the rows with negative values, the dataset now has `4,241 observations`. The distributions across all variables look almost identical to before, showing that this cleaning step didn’t affect the data overall.

## Exploratory Data Analysis

### Does education level affect loan approval?
Here, we aim to examine whether the person's **education** (`Graduated` or `Not Graduated`) affects the approval or rejection of a loan. We begin by visualizing the distribution of approved and rejected applications for each education group using a bar chart.
```{r Q1, echo=TRUE}
library(ggplot2)
ggplot(loan_df, aes(x = loan_status, fill = education)) +
  geom_bar(position = "dodge") +
  labs(
    title = "Loan Approval by Education Level",
    x = "Loan Status",
    y = "Number of Applicants"
  ) +
  scale_fill_manual(
    values = c(" Graduate" = "#FF7C61", " Not Graduate" = "#50E5C8")
  ) +
  theme_minimal()
```

Approval rates are nearly **identical** for Graduated and Not Graduated applicants, suggesting education likely doesn’t affect loan approval. A Chi-square test will confirm this statistically.

#### Hypotheses:
- **Null hypothesis (H₀):** Loan approval is independent of education level (Graduated vs Not Graduated).
- **Alternative hypothesis (H₁):** Loan approval depends on education level; there is an association between education and loan approval.

```{r echo=TRUE}
edu_table <- table(loan_df$education, loan_df$loan_status)
print(edu_table)

edu_chi <- chisq.test(edu_table)
print(edu_chi)
```
#### Conclusion
The Chi-square test yielded a **p-value** of `0.8`. Since this is greater than `0.05`, we fail to reject the null hypothesis, indicating that there is no significant association between education level and loan approval. This confirms that, in this dataset, education does not appear to affect the likelihood of a loan being approved.

### Do people with higher asset values tend to get approved more often?
Here, we aim to examine whether the value of a person’s assets, including residential, commercial, luxury, and bank assets, individually affects the approval or rejection of a loan. We begin by visualizing the frequency distribution of each type of asset value.
```{r echo=TRUE}
# 1. Residential Assets Histogram
hist(loan_df$residential_assets_value,
     main = "Distribution of Residential Assets Value",
     xlab = "Residential Assets Value",
     col = "lightblue",
     border = "black")

# 2. Commercial Assets Histogram
hist(loan_df$commercial_assets_value,
     main = "Distribution of Commercial Assets Value",
     xlab = "Commercial Assets Value",
     col = "lightgreen",
     border = "black")

# 3. Luxury Assets Histogram
hist(loan_df$luxury_assets_value,
     main = "Distribution of Luxury Assets Value",
     xlab = "Luxury Assets Value",
     col = "pink",
     border = "black")

# 4. Bank Assets Histogram
hist(loan_df$bank_asset_value,
     main = "Distribution of Bank Assets Value",
     xlab = "Bank Assets Value",
     col = "salmon",
     border = "black")

# Reset plotting layout to default (1 plot per screen) after generation
par(mfrow = c(1, 1))
```
Each type of asset value shows a right-skewed distribution, meaning most individuals hold lower asset values while a smaller number possess much higher ones, indicating non-normality. To statistically verify this, we can apply the Shapiro–Wilk test, which checks whether the data follow a normal distribution.

#### Hypotheses:
- **Null hypothesis (H₀):** The data are normally distributed.
- **Alternative hypothesis (H₁):** The data are not normally distributed.
We use this test to confirm whether the visual observation of skewness is statistically significant.

```{r echo=TRUE}
shapiro.test(loan_df$residential_assets_value)
shapiro.test(loan_df$commercial_assets_value)
shapiro.test(loan_df$luxury_assets_value)
shapiro.test(loan_df$bank_asset_value)
```
Since all **p-values** are far below `0.05`, we **reject the null hypothesis** for each test. This indicates that none of the asset value distributions are normally distributed, which is consistent with the right-skewed patterns observed in the histograms. 
Let's visualize the impact of asset values on loan status using a **box plot**.

```{r echo=TRUE}
# Convert to long format
loan_long <- loan_df %>%
  pivot_longer(
    cols = c(residential_assets_value, commercial_assets_value, luxury_assets_value, bank_asset_value),
    names_to = "asset_type",
    values_to = "asset_value"
  )

# Boxplots all in one figure
ggplot(loan_long, aes(x = asset_type, y = asset_value, fill = loan_status)) +
  geom_boxplot(position = position_dodge(width = 0.8)) +
  labs(
    title = "Asset Distributions by Loan Status",
    x = "Asset Type",
    y = "Asset Value"
  ) +
  theme_minimal() +
  scale_fill_manual(values = c(" Approved" = "#1b9e77", " Rejected" = "#d95f02"))
```
The **median** and **range** of each asset type are similar between `Approved` and `Rejected` loans, suggesting little apparent effect on loan decisions. Since the Shapiro-Wilk test showed that asset values are not normally distributed, we use the Wilcoxon rank-sum test to formally assess differences.

#### Hypotheses for each asset type:
- **Null hypothesis (H₀):** The distribution of asset values is the same for Approved and Rejected loans.
- **Alternative hypothesis (H₁):** The distribution of asset values differs between Approved and Rejected loans.

```{r echo=TRUE}
wilcox.test(residential_assets_value ~ loan_status, data = loan_df)
wilcox.test(commercial_assets_value ~ loan_status, data = loan_df)
wilcox.test(luxury_assets_value ~ loan_status, data = loan_df)
wilcox.test(bank_asset_value ~ loan_status, data = loan_df)
```

#### Conclusion
All **p-values** are greater than `0.05`, so we **fail to reject the null hypothesis** for each asset type. This indicates that there is no statistically significant difference in asset values between Approved and Rejected loans, supporting the initial observation that **asset values do not appear to affect loan approval decisions**.

### Is there a significant difference in average income between approved and rejected applicants?
Here, we aim to examine whether the person's **annual income** affects the approval or rejection of a loan. We begin by visualizing the frequency distribution of annual income.
```{r echo=TRUE}
hist(loan_df$income_annum,
     main = "Distribution of Annual income",
     xlab = "Annual income",
     col = "salmon",
     border = "black")
```
The frequency distribution shows that annual income is **roughly uniform and symmetric**, with **no noticeable skew or extreme outliers**. We can now examine the distribution of annual income for `Approved` and `Rejected` applicants using a box plot.

```{r echo=TRUE}
ggplot(loan_df, aes(x = loan_status, y = income_annum, fill = loan_status)) +
  geom_boxplot() +
  labs(title = "Annual Distribution by Loan Status", x = "Loan Status", y = "Annual Income") +
  scale_fill_manual(values = c(" Approved" = "#12362A", " Rejected" = "#8DD9C1"))
```
The box plot shows that the income distributions for both `Approved` and `Rejected` applicants are quite similar. The **median** income for both groups is approximately `5 million`, and the small difference in the lower quartiles appears negligible. To statistically verify this observation, we will perform a two-sample t-test to compare the means of the two groups.

- **Null Hypothesis (H₀):** There is no significant difference in the average annual income between approved and rejected applicants.

- **Alternative Hypothesis (H₁):** There is a significant difference in the average annual income between approved and rejected applicants.

```{r echo=TRUE}
approved_income <- loan_df$income_annum[loan_df$loan_status == " Approved"]
rejected_income <- loan_df$income_annum[loan_df$loan_status == " Rejected"]
t.test(approved_income, rejected_income)
```

#### Conclusion
Since the `p-value(0.2)> 0.05`, we **fail to reject the null hypothesis**, indicating that there is no statistically significant difference in mean income between Approved and Rejected applicants.So the data supports the earlier observation from the box plot i.e. annual income does not appear to affect loan approval in this dataset.



### Is there a correlation between applicant's annual income and loan amount requested?
Here, we aim to examine whether the **loan amount requested** is influenced by an applicant’s **annual income**. Understanding this relationship helps identify potential **multicollinearity**. Moreover, We already know that annual income is not skewed and roughly uniform and symmetric, we can now visualize the distribution for loan amount requested.
```{r, echo=TRUE}
hist(loan_df$loan_amount,
     main = "Distribution of Loan amount reuqested",
     xlab = "Loan amount requested",
     col = "yellow",
     border = "black")
```
The distribution of loan amount is right-skewed and deviates from normality. Therefore, we will first visualize the relationship between annual income and the requested loan amount, and then use Spearman’s correlation test, as it does not assume normality.

```{r Q4, echo=TRUE}
annual_income <- loan_df$income_annum
loan_amount <- loan_df$loan_amount

ggplot(data = loan_df, aes(x = loan_amount, y = income_annum)) +
  geom_point(color = "#F7AC19") +
  labs(
    title = "Scatter plot of Annual Income vs Loan Amount",
    x = "Loan Amount",
    y = "Annual Income"
  ) +
  theme_minimal()
```
A positive correlation is evident, indicating that applicants with higher annual incomes tend to apply for and receive larger loan amounts. We can use a spearman correlation test to verify this. 

- **Null Hypothesis (H₀):** There is no relationship between annual income and loan amount among applicants.

- **Alternative Hypothesis (H₁):** Applicants with higher annual incomes tend to apply for and receive larger loan amounts.

```{r echo=TRUE}
cor.test(annual_income, loan_amount, method = "spearman")
```
#### Conclusion:
The Spearman’s rank correlation test shows a very strong positive correlation between annual income and loan amount `(ρ = 0.941, p < 0.001)`. This indicates that as applicants’ annual income increases, the loan amount they apply for and receive also tends to increase. Since the p-value is far below `0.05`, we reject the null hypothesis and conclude that there is a significant positive relationship between annual income and loan amount. This strong association suggests that the two variables convey similar information.

### Is there a significant difference in average CIBIL scores between approved and rejected applicants?
```{r Q5, echo=TRUE}
library(ggplot2)
#CIBIL score frequency distribution
hist(loan_df$cibil_score, main = "Frequency Distribution of CIBIL Scores", xlab = "CIBIL Score", ylab = "Frequency", breaks = 15, col = "#197571")

#CIBIL score frequency box chart
ggplot(loan_df, aes(x = loan_status, y = cibil_score, fill = loan_status)) +
  geom_boxplot() +
  labs(title = "CIBIL Score Distribution by Loan Status", x = "Loan Status", y = "CIBIL Score") +
  scale_fill_manual(values = c(" Approved" = "#197571", " Rejected" = "#FFCF85"))

#t-test
t.test(cibil_score ~ loan_status, data = loan_df)

```
The overall CIBIL score frequency distribution shows no apparent outliers. The individual distributions for approved and rejected loans show a few outliers, but it is not necessary to remove them. Even though the outliers are dragging the two means closer to each other, the means are still significantly different even when including them in the t-test.

There is a significant difference in CIBIL scores between approved and rejected applicants because the p-value, `2e-16`, is much lower than the standard alpha threshold of `0.05`. This allows us to reject the null hypothesis that the two means of approved and rejected applicants are **equal**.

### For rejected loans, is there a significant difference in the mean CIBIL score between applicants with shorter loan term loans (<=10 years) versus longer term loans(>10 years)?
```{r Q6, echo=TRUE}

#created subsets for shorter and longer loans then ran t-test
rejected_shorter <- subset(loan_df, trimws(loan_status) == "Rejected" & loan_term <= 10)
rejected_longer <- subset(loan_df, trimws(loan_status) == "Rejected" & loan_term > 10)

#Overall loan term frequency distribution
ggplot(loan_df, aes(x = factor(loan_term))) + geom_bar(fill = "#7B3D91") + labs(title = "Frequency Distribution of Loan Terms", x = "Loan Term (Years)", y = "Frequency")

#boxplot
boxplot(
  rejected_shorter$cibil_score,
  rejected_longer$cibil_score,
  names = c("Shorter (<= 10 yrs)", "Longer (> 10 yrs)"),
  main = "CIBIL Score Distribution for Rejected Loans",
  ylab = "CIBIL Score",
  xlab = "Loan Term Group",
  col = c("#A769C2", "#87BDCC")  # add your custom colors here
)
#removing outliers
removeOutliers <- function(x) {Q1 <- quantile(x, 0.25)
Q3 <- quantile(x, 0.75);
IQR_val <- Q3 - Q1;
lower_bound <- Q1 - (1.5 * IQR_val);
upper_bound <- Q3 + (1.5 * IQR_val);
  
return(x[x >= lower_bound & x <= upper_bound]);}

cleaned_shorter_cibil <- removeOutliers(rejected_shorter$cibil_score)
cleaned_longer_cibil <- removeOutliers(rejected_longer$cibil_score)

t.test(rejected_shorter$cibil_score, rejected_longer$cibil_score)
t.test(cleaned_shorter_cibil, cleaned_longer_cibil)

```

The overall loan terms frequency distribution shows no apparent outliers however there are a few in the shorter and longer loan term groups. Having this said, even when removing these outliers there no significant differences found between the two groups and their respective CIBIL scores.

There is not a significant difference in CIBIL scores between shorter `(<= 10 years)` and longer `(>10 years)` term loans within the rejected group of applicants because the **p-value**, `1`, is much higher than the standard alpha threshold of `0.05`. This allows us to accept the null hypothesis that the two means of shorter and longer term loans of rejected applicants are equal.

### Is there a correlation between the CIBIL Score and the Loan Term among those whose loans are approved?  
```{r Q7, echo=TRUE}

#correlation coefficient
corr_r <- cor(loan_df[trimws(loan_df$loan_status) == "Approved", "cibil_score"], loan_df[trimws(loan_df$loan_status) == "Approved", "loan_term"], method = "pearson")

#correlation test
cor.test(loan_df[trimws(loan_df$loan_status) == "Approved", "cibil_score"], loan_df[trimws(loan_df$loan_status) == "Approved", "loan_term"], method = "pearson")

#scatter plot
ggplot(subset(loan_df, trimws(loan_status) == "Approved"), aes(x = loan_term, y = cibil_score)) + geom_point(alpha = 0.4, color = "#AAE5D8") + geom_smooth(method = "lm", se = FALSE, color = "#061411") + labs(title = "CIBIL Score vs. Loan Term for Approved Loans", x = "Loan Term (Years)", y = "CIBIL Score")

```

The correlation coefficient of `0.21` shows a weak but positive relationship where approved candidates with higher CIBIL scores have a slightly higher tendency to approved for longer loan terms. And the p-value is very small, `2e-16`, meaning that the correlation coefficient is unlikely due to chance.

### Does self-employment status affect loan approval?
Here, we aim to examine whether the person's employment status affects the approval or rejection of a loan. We begin by visualizing the distribution of approved and rejected applications for each employment group using a bar chart.
```{r Q8, echo=TRUE}
ggplot(loan_df, aes(x = self_employed, fill = loan_status)) +
  geom_bar(position = "dodge") +
  labs(
    title = "Loan Approval by self employment status",
    x = "self employment status",
    y = "Number of Applicants"
  ) +
  scale_fill_manual(values = c(" Approved" = "#F2764E", " Rejected" = "#FAF487")) +
  theme_minimal()
```
Approval rates are nearly **identical** for self-employed and non self-employed applicants, suggesting self-employment likely doesn’t affect loan approval. A Chi-square test will confirm this statistically.

#### Hypotheses:
- **Null hypothesis (H₀):** Loan approval is independent of employment status
- **Alternative hypothesis (H₁):** Loan approval depends on employment status; there is an association between employment status and loan approval.

```{r, echo=TRUE}
contable <- table(loan_df$self_employed, loan_df$loan_status)
chisq.test(contable)
```
#### Conclusion
The Chi-square test (`p = 1`) also shows no significant association between self-employment status and loan approval. This confirms that self-employment does not affect the likelihood of loan approval in this dataset.

### Does the number of dependents affect approval of loans?
```{r Q9, echo=TRUE}
ggplot(loan_df, aes(x = no_of_dependents, fill = loan_status)) +
  geom_bar(position = "dodge") +
  labs(
    title = "Loan Approval by Number of Dependents",
    x = "Number of Dependents",
    y = "Number of Applicants"
  ) +
  scale_fill_manual(values = c(" Approved" = "#0D0942", " Rejected" = "#C4C0F6")) +
  theme_minimal()
```
The bar chart shows that approval and rejection counts are fairly similar across all dependent categories, with no noticeable trend suggesting that the number of dependents strongly influences loan approval outcomes. While minor variations exist, the approval rate appears consistent across groups, indicating that loan approval is likely independent of the number of dependents. A Chi-square test will confirm this statistically.

```{r, echo=TRUE}
contable <- table(loan_df$no_of_dependents, loan_df$loan_status)
chisq.test(contable)
```
The Chi-square test (`p = 0.8`) also shows no significant association between no_of_dependents and loan approval. This confirms that no_of_dependents does not affect the likelihood of loan approval in this dataset.

### Does requested loan term affect approval?
```{r Q10, echo=TRUE}
ggplot(loan_df, aes(x = loan_status, y = loan_term, fill = loan_status)) +
  geom_boxplot(alpha = 0.6) +
  labs(
    title = "Loan Term by Loan Approval Status",
    x = "Loan Status",
    y = "Loan Term (Years)"
  ) +
  scale_fill_manual(values = c(" Approved" = "#98C25F", " Rejected" = "#EB3BA7")) +
  theme_minimal()
```
The boxplot shows that approved loans have a **wider range** of terms, including very short loans, while rejected loans generally have longer terms. The median loan term for approved loans is `10 years`, compared to `12 years` for rejected loans, indicating that rejected loans tend to have slightly longer terms


```{r, echo=TRUE}
t.test(loan_term ~ loan_status, data = loan_df)
```
The two-sample t-test indicates a significant difference in means (`p < 0.05`), with approved loans having a shorter average term (`10.4 years`) than rejected loans (`11.7 years`). The `95%` confidence interval for the mean difference is `-1.69 to -1.01` (the interval doesn't have 0), confirming that approved loans tend to have shorter terms.

## References
