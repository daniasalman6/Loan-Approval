---
title: "Data Science Project - Loan Approval"
author: "Alex Biuckians, Armin Soroosh, Dania Salman, Kaipu Liu"
output:
  html_document:
    code_folding: hide
    number_sections: false
    theme: journal
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
library(ezids)
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
#knitr::opts_chunk$set(warning = F, results="hide", message = F)
knitr::opts_chunk$set(warning = F, message = F)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
```

## Loading the Dataset
```{r read_dataset, echo=TRUE}
# reading dataset
loan_df <- data.frame(read.csv("loan_approval_dataset.csv"))
```

```{r explore_dataset, echo=TRUE}
# exploring dataset
str(loan_df)
```
The dataset has **4269 observations** with **13 variables**

## Data Cleaning & Summary

### subsetting data and converting categorical variables to factor
Removing loan_id column since it only serves as a unique identifier and does not contribute to the analysis. Furthermore, converting several numeric variables into factors, as they represent categorical information rather than continuous numerical values.
```{r data_cleaning, echo=TRUE}
loan_df <- subset(loan_df, select = -c(loan_id))

# converting the numeric variables to factor variables
loan_df$no_of_dependents = as.factor(loan_df$no_of_dependents)
loan_df$education = as.factor(loan_df$education)
loan_df$self_employed = as.factor(loan_df$self_employed)
loan_df$loan_status = as.factor(loan_df$loan_status)
str(loan_df)
```
After conversion, the dataset contains four categorical variables:

- **no_of_dependents:** Number of dependents the applicant has (`6` categories: `0`, `1`, `2`, `3`, `4`, `5`)

- **education:** Applicant’s level of education (`2` categories: `Graduate`, `Not Graduate`)

- **self_employed:** Whether the applicant is self-employed (`2` categories: `Yes`, `No`)

- **loan_status:** Loan approval status — this is the target variable (`2` categories: `Approved`, `Rejected`)

### Finding NA values
```{r, echo=TRUE}
sum(is.na(loan_df))
```
There are no NA values in the data set

### Summary of the dataset
```{r echo=TRUE}
summary(loan_df)
```
Overall, the dataset appears well-structured and balanced. **Categorical variables** such as `education`, `self_employment`, and `loan_status` show nearly **even distributions** across their categories. Most **numerical variables** fall within reasonable ranges, with average loan terms around `11 years` and CIBIL scores centered near `600`, both indicating realistic applicant profiles. However, some financial variables like income, loan amount, and asset values show wide variation and possible outliers. In particular, the presence of negative values in `residential_assets_value` points to potential data quality issues that will need correction before exploration or testing.

### Cleaning up negative values
Checking the number of rows that have negative values for `residential_assets_value` column
```{r echo=TRUE}
sum(loan_df$residential_assets_value < 0)
```
There are `28` entries with negative values.

### Removing entries with negative values
```{r echo=TRUE}
loan_df <- loan_df[loan_df$residential_assets_value >= 0, ]
str(loan_df)
summary(loan_df)
```
After filtering out the rows with negative values, the dataset now has `4,241 observations`. The distributions across all variables look almost identical to before, showing that this cleaning step didn’t affect the data overall.

## Exploratory Data Analysis

### Does education level affect loan approval?
```{r Q1, echo=TRUE}

```

### Do people with higher asset values tend to get approved more often?
```{r Q2, echo=TRUE}

```

### Is there a significant difference in average income between approved and rejected applicants?
```{r Q3, echo=TRUE}
# Group by loan approval status and extract their annual income data
approved_income <- loan_df$income_annum[loan_df$loan_status == " Approved"]
rejected_income <- loan_df$income_annum[loan_df$loan_status == " Rejected"]
# Calculate each group's mean annual income
mean_approved <- mean(approved_income, na.rm = TRUE)
mean_rejected <- mean(rejected_income, na.rm = TRUE)
cat("Mean annual income of Approved group:", mean_approved, "\n")
cat("Mean annual income of Rejected group:", mean_rejected, "\n")

# Conduct hypothesis testing
t_test_result <- t.test(approved_income, rejected_income)
print("t-test result：")
print(t_test_result)
# Draw the histogram
hist(approved_income, 
     col = "lightgreen",
     main = "The distribution of annual income", 
     xlab = "Annual income", 
     ylab = "Frequency",
     breaks = 30)
hist(rejected_income, 
     col = "red", 
     breaks = 30,
     add = TRUE)
legend("topright", 
       legend = c("Approved", "Rejected"), 
       fill = c("lightgreen", "red")) 

```
The average income of the approved group is 5,025,904, and that of the rejected group is 5,113,825, with a difference of approximately 87,921. Then I did the hypothesis testing to do advanced judgment.

H0: There is no significant difference in the average annual income between two groups.
H1: There is a significant difference in the average annual income between two groups.

According to the result of t-test:
t-value: -1, indicating that the difference between the two group means is not prominent compared to the sample variation.
p-value: 0.3 which is much larger than the significance level of 0.05, indicating that the different is non-significant.
95% confidence interval: [-260,821, 84,978]. The interval contains 0, indicating that the mean difference between the two groups may be 0.
Finally, I drew the histogram chart, the distribution of each group's annual income is uniform. Also enhanced the conclusion.

All above suggests that income alone may not be a strong predictor of loan approval in this dataset.



### Is there a correlation between applicant's annual income and loan amount requested?
```{r Q4, echo=TRUE}
annual_income <- loan_df$income_annum
loan_amount <- loan_df$loan_amount

# Check whether normal distribution
shapiro_income <- shapiro.test(annual_income)
shapiro_loan <- shapiro.test(loan_amount)
cat("p-value of annual income：", shapiro_income$p.value, "\n")
cat("p-value of loan amount：", shapiro_loan$p.value, "\n")
# Choose the correlation coefficient
if (shapiro_income$p.value > 0.05 & shapiro_loan$p.value > 0.05) {
  cor_result <- cor.test(annual_income, loan_amount, method = "pearson")
  cat("Pearson result：\n")
} else {
  cor_result <- cor.test(annual_income, loan_amount, method = "spearman")
  cat("Spearman reslut：\n")
}
print(cor_result)

# Draw the plot
plot(
  x = annual_income,
  y = loan_amount,
  main = "Annual Income vs. Loan Amount Requested",
  xlab = "Annual Income",
  ylab = "Loan Amount Requested",
  pch = 16,
  col = "lightblue",
  cex = 0.8
)
# Add the regression line
abline(lm(loan_amount ~ annual_income), col = "red", lwd = 2)
legend("topleft", 
       legend = "regression line", 
       col = "red", 
       lty = 1, 
       lwd = 2)




```
I checked whether the data of annual income and loan amount is follow the normal distribution and choose the Spearman  correlation coefficient according to the result.
The rho is 0.941 which is close to 1, indicating that there is a very strong positive monotonic correlation between the annual income and loan amount exist and the p-value is far less than 0.05 also showed this correlation is very significant in statistic.
Then according to the plot chart, it's very clear that the loan amount shows an obvious upward trend from the bottom left to the top right as annual income increases, and the red regression line further strengthens the visual evidence of this linear association, indicating a strong positive correlation tendency between the two.
In short, this analysis clearly draws the conclusion that "annual income is a key factor affecting the loan application amount, and there is a strong positive correlation between the two."

### Is there a significant difference in average CIBIL scores between approved and rejected applicants?
```{r Q5, echo=TRUE}
library(ggplot2)
#CIBIL score frequency distribution
hist(loan_df$cibil_score, main = "Frequency Distribution of CIBIL Scores", xlab = "CIBIL Score", ylab = "Frequency", breaks = 15, col = "lightblue")

#CIBIL score frequency distribution
loan_df$loan_status <- factor(trimws(loan_df$loan_status))
ggplot(loan_df, aes(x = cibil_score, fill = loan_status)) +
  geom_histogram(binwidth = 50, color = "white", alpha = 0.8) +
  facet_wrap(~ loan_status, scales = "free_y") +
  labs(title = "CIBIL Score Distribution by Loan Status", x = "CIBIL Score", y = "Frequency", fill = "Loan Status") + scale_fill_manual(values = c("Approved" = "darkgreen", "Rejected" = "darkred"))

#CIBIL score frequency box chart
ggplot(loan_df, aes(x = loan_status, y = cibil_score, fill = loan_status)) +
  geom_boxplot() +
  labs(title = "CIBIL Score Distribution by Loan Status", x = "Loan Status", y = "CIBIL Score") +
  scale_fill_manual(values = c("Approved" = "darkgreen", "Rejected" = "darkred"))

#t-test
t.test(cibil_score ~ loan_status, data = loan_df)

```
The overall CIBIL score frequency distribution shows no apparent outliers. The individual distributions for approved and rejected loans show a few outliers, but it is not necessary to remove them. Even though the outliers are dragging the two means closer to each other, the means are still significantly different even when including them in the t-test.

There is a significant difference in CIBIL scores between approved and rejected applicants because the p-value, 2e-16, is much lower than the standard alpha threshold of 0.05. This allows us to reject the null hypothesis that the two means of approved and rejected applicants are equal.

### For rejected loans, is there a significant difference in the mean CIBIL score between applicants with shorter loan term loans (<=10 years) versus longer term loans(>10 years)?
```{r Q6, echo=TRUE}

#created subsets for shorter and longer loans then ran t-test
rejected_shorter <- subset(loan_df, trimws(loan_status) == "Rejected" & loan_term <= 10)
rejected_longer <- subset(loan_df, trimws(loan_status) == "Rejected" & loan_term > 10)

#Overall loan term frequency distribution
ggplot(loan_df, aes(x = factor(loan_term))) + geom_bar(fill = "lightblue") + labs(title = "Frequency Distribution of Loan Terms", x = "Loan Term (Years)", y = "Frequency")

#boxplot
boxplot(rejected_shorter$cibil_score, rejected_longer$cibil_score, names = c("Shorter (<= 10 yrs)", "Longer (> 10 yrs)"), main = "CIBIL Score Distribution for Rejected Loans", ylab = "CIBIL Score", xlab = "Loan Term Group")

#removing outliers
removeOutliers <- function(x) {Q1 <- quantile(x, 0.25)
Q3 <- quantile(x, 0.75);
IQR_val <- Q3 - Q1;
lower_bound <- Q1 - (1.5 * IQR_val);
upper_bound <- Q3 + (1.5 * IQR_val);
  
return(x[x >= lower_bound & x <= upper_bound]);}

cleaned_shorter_cibil <- removeOutliers(rejected_shorter$cibil_score)
cleaned_longer_cibil <- removeOutliers(rejected_longer$cibil_score)

t.test(rejected_shorter$cibil_score, rejected_longer$cibil_score)
t.test(cleaned_shorter_cibil, cleaned_longer_cibil)

```

The overall loan terms frequency distribution shows no apparent outliers however there are a few in the shorter and longer loan term groups. Having this said, even when removing these outliers there no significant differences found between the two groups and their respective CIBIL scores.

There is not a significant difference in CIBIL scores between shorter (<= 10 years) and longer (>10 years) term loans within the rejected group of applicants because the p-value, 1, is much higher than the standard alpha threshold of 0.05. This allows us to accept the null hypothesis that the two means of shorter and longer term loans of rejected applicants are equal.

### Is there a correlation between the CIBIL Score and the Loan Term among those whose loans are approved?  
```{r Q7, echo=TRUE}

#correlation coefficient
corr_r <- cor(loan_df[trimws(loan_df$loan_status) == "Approved", "cibil_score"], loan_df[trimws(loan_df$loan_status) == "Approved", "loan_term"], method = "pearson")

#correlation test
cor.test(loan_df[trimws(loan_df$loan_status) == "Approved", "cibil_score"], loan_df[trimws(loan_df$loan_status) == "Approved", "loan_term"], method = "pearson")

#scatter plot
ggplot(subset(loan_df, trimws(loan_status) == "Approved"), aes(x = loan_term, y = cibil_score)) + geom_point(alpha = 0.4, color = "blue") + geom_smooth(method = "lm", se = FALSE, color = "red") + labs(title = "CIBIL Score vs. Loan Term for Approved Loans", x = "Loan Term (Years)", y = "CIBIL Score")

```

The correlation coefficient of 0.21 shows a weak but positive relationship where approved candidates with higher CIBIL scores have a slightly higher tendency to approved for longer loan terms. And the p-value is very small, 2e-16, meaning that the correlation coefficient is unlikely due to chance.

### Does self-employment status affect loan approval?
```{r Q8, echo=TRUE}
ggplot(loan_df, aes(x = self_employed, fill = loan_status)) +
  geom_bar(position = "dodge") +
  labs(
    title = "Loan Approval by Number of Dependents",
    x = "Number of Dependents",
    y = "Number of Applicants"
  ) +
  scale_fill_manual(values = c("Approved" = "#F2764E", Rejected = "#FAF487")) +
  theme_minimal()
```
Approval rates are nearly **identical** for self-employed and non self-employed applicants, suggesting self-employment likely doesn’t affect loan approval. A Chi-square test will confirm this statistically.

```{r, echo=TRUE}
contable <- table(loan_df$self_employed, loan_df$loan_status)
chisq.test(contable)
```
The Chi-square test (`p = 1`) also shows no significant association between self-employment status and loan approval. This confirms that self-employment does not affect the likelihood of loan approval in this dataset.

### Does the number of dependents affect approval of loans?
```{r Q9, echo=TRUE}
ggplot(loan_df, aes(x = no_of_dependents, fill = loan_status)) +
  geom_bar(position = "dodge") +
  labs(
    title = "Loan Approval by Number of Dependents",
    x = "Number of Dependents",
    y = "Number of Applicants"
  ) +
  scale_fill_manual(values = c("Approved" = "#0D0942", "Rejected" = "#C4C0F6")) +
  theme_minimal()
```
The bar chart shows that approval and rejection counts are fairly similar across all dependent categories, with no noticeable trend suggesting that the number of dependents strongly influences loan approval outcomes. While minor variations exist, the approval rate appears consistent across groups, indicating that loan approval is likely independent of the number of dependents. A Chi-square test will confirm this statistically.

```{r, echo=TRUE}
contable <- table(loan_df$no_of_dependents, loan_df$loan_status)
chisq.test(contable)
```
The Chi-square test (`p = 0.8`) also shows no significant association between no_of_dependents and loan approval. This confirms that no_of_dependents does not affect the likelihood of loan approval in this dataset.

### Does requested loan term affect approval?
```{r Q10, echo=TRUE}
ggplot(loan_df, aes(x = loan_status, y = loan_term, fill = loan_status)) +
  geom_boxplot(alpha = 0.6) +
  labs(
    title = "Loan Term by Loan Approval Status",
    x = "Loan Status",
    y = "Loan Term (Years)"
  ) +
  scale_fill_manual(values = c("Approved" = "#98C25F", "Rejected" = "#EB3BA7")) +
  theme_minimal()
```
The boxplot shows that approved loans have a **wider range** of terms, including very short loans, while rejected loans generally have longer terms. The median loan term for approved loans is `10 years`, compared to `12 years` for rejected loans, indicating that rejected loans tend to have slightly longer terms


```{r, echo=TRUE}
t.test(loan_term ~ loan_status, data = loan_df)
```
The two-sample t-test indicates a significant difference in means (`p < 0.05`), with approved loans having a shorter average term (`10.4 years`) than rejected loans (`11.7 years`). The `95%` confidence interval for the mean difference is `-1.69 to -1.01` (the interval doesn't have 0), confirming that approved loans tend to have shorter terms.
