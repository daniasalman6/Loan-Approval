library(caret)
library(e1071)
# Combine original features with cluster labels
cluster_data <- df_unscaled   # df_unscaled already includes: loan_amount, combined_asset_value, cibil_score, income_annum, cluster
# some of common options (and the defaults) are:
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right',
library(ezids)
library(dplyr)
library(tidyr)
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
#knitr::opts_chunk$set(warning = F, results="hide", message = F)
knitr::opts_chunk$set(warning = F, message = F)
options(scientific=T, digits = 3)
# options(scipen=9, digits = 3)
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
# reading dataset
loan_df <- data.frame(read.csv("loan_approval_dataset.csv"))
# exploring dataset
str(loan_df)
loan_df <- subset(loan_df, select = -c(loan_id))
# converting the numeric variables to factor variables
loan_df$no_of_dependents = as.factor(loan_df$no_of_dependents)
loan_df$education = as.factor(loan_df$education)
loan_df$self_employed = as.factor(loan_df$self_employed)
loan_df$loan_status = as.factor(loan_df$loan_status)
str(loan_df)
library(knitr)
# Sample data frame
loan_data <- data.frame(
Variable = c("no_of_dependents", "education", "self_employed", "income_annum", "loan_amount", "loan_term", "cibil_score", "residential_assets_value", "commercial_assets_value", "luxury_assets_value", "bank_asset_value", "loan_status"),
Description = c("Number of dependents an applicant has ranging from 0 to 5", "Education level (Graduate or Not Graduate)", "Whether the applicant works independently or for an employer", "Annual income of applicant", "Amount of loan requested", "The number of years in which the applicant will repay the loan","Credit score indicating applicants history of repayment", "Value of applicant's residential assets if any", "Value of applicant's commercial assets if any", "Value of applicant's luxury assets if any", "Value of applicant's bank assets if any", "Target variable indicating whether the loan was Approved or Rejected"),
Type = c("Categorical", "Categorical", "Categorical", "Numeric", "Numeric", "Numeric", "Numeric", "Numeric", "Numeric", "Numeric", "Numeric", "Categorical")
)
# Create table
kable(loan_data)
sum(is.na(loan_df))
summary(loan_df)
sum(loan_df$residential_assets_value < 0)
loan_df <- loan_df[loan_df$residential_assets_value >= 0, ]
str(loan_df)
summary(loan_df)
library(ggplot2)
ggplot(loan_df, aes(x = loan_status, fill = education)) +
geom_bar(position = "dodge") +
labs(
title = "Loan Approval by Education Level",
x = "Loan Status",
y = "Number of Applicants"
) +
scale_fill_manual(
values = c(" Graduate" = "#FF7C61", " Not Graduate" = "#50E5C8")
) +
theme_minimal()
edu_table <- table(loan_df$education, loan_df$loan_status)
print(edu_table)
edu_chi <- chisq.test(edu_table)
print(edu_chi)
# 1. Residential Assets Histogram
hist(loan_df$residential_assets_value,
main = "Distribution of Residential Assets Value",
xlab = "Residential Assets Value",
col = "lightblue",
border = "black")
# 2. Commercial Assets Histogram
hist(loan_df$commercial_assets_value,
main = "Distribution of Commercial Assets Value",
xlab = "Commercial Assets Value",
col = "lightgreen",
border = "black")
# 3. Luxury Assets Histogram
hist(loan_df$luxury_assets_value,
main = "Distribution of Luxury Assets Value",
xlab = "Luxury Assets Value",
col = "pink",
border = "black")
# 4. Bank Assets Histogram
hist(loan_df$bank_asset_value,
main = "Distribution of Bank Assets Value",
xlab = "Bank Assets Value",
col = "salmon",
border = "black")
# Reset plotting layout to default (1 plot per screen) after generation
par(mfrow = c(1, 1))
shapiro.test(loan_df$residential_assets_value)
shapiro.test(loan_df$commercial_assets_value)
shapiro.test(loan_df$luxury_assets_value)
shapiro.test(loan_df$bank_asset_value)
# Convert to long format
loan_long <- loan_df %>%
pivot_longer(
cols = c(residential_assets_value, commercial_assets_value, luxury_assets_value, bank_asset_value),
names_to = "asset_type",
values_to = "asset_value"
)
# Boxplots all in one figure
ggplot(loan_long, aes(x = asset_type, y = asset_value, fill = loan_status)) +
geom_boxplot(position = position_dodge(width = 0.8)) +
labs(
title = "Asset Distributions by Loan Status",
x = "Asset Type",
y = "Asset Value"
) +
theme_minimal() +
scale_fill_manual(values = c(" Approved" = "#1b9e77", " Rejected" = "#d95f02"))
wilcox.test(residential_assets_value ~ loan_status, data = loan_df)
wilcox.test(commercial_assets_value ~ loan_status, data = loan_df)
wilcox.test(luxury_assets_value ~ loan_status, data = loan_df)
wilcox.test(bank_asset_value ~ loan_status, data = loan_df)
hist(loan_df$income_annum,
main = "Distribution of Annual income",
xlab = "Annual income",
col = "salmon",
border = "black")
ggplot(loan_df, aes(x = loan_status, y = income_annum, fill = loan_status)) +
geom_boxplot() +
labs(title = "Annual Distribution by Loan Status", x = "Loan Status", y = "Annual Income") +
scale_fill_manual(values = c(" Approved" = "#12362A", " Rejected" = "#8DD9C1"))
approved_income <- loan_df$income_annum[loan_df$loan_status == " Approved"]
rejected_income <- loan_df$income_annum[loan_df$loan_status == " Rejected"]
t.test(approved_income, rejected_income)
hist(loan_df$loan_amount,
main = "Distribution of Loan amount requested",
xlab = "Loan amount requested",
col = "yellow",
border = "black")
annual_income <- loan_df$income_annum
loan_amount <- loan_df$loan_amount
ggplot(data = loan_df, aes(x = loan_amount, y = income_annum)) +
geom_point(color = "#F7AC19") +
labs(
title = "Scatter plot of Annual Income vs Loan Amount",
x = "Loan Amount",
y = "Annual Income"
) +
theme_minimal()
cor.test(annual_income, loan_amount, method = "spearman")
library(ggplot2)
#CIBIL score frequency distribution
hist(loan_df$cibil_score, main = "Frequency Distribution of CIBIL Scores", xlab = "CIBIL Score", ylab = "Frequency", breaks = 15, col = "#197571")
#CIBIL score frequency box chart
ggplot(loan_df, aes(x = loan_status, y = cibil_score, fill = loan_status)) +
geom_boxplot() +
labs(title = "CIBIL Score Distribution by Loan Status", x = "Loan Status", y = "CIBIL Score") +
scale_fill_manual(values = c(" Approved" = "#197571", " Rejected" = "#FFCF85"))
#t-test
t.test(cibil_score ~ loan_status, data = loan_df)
#created subsets for shorter and longer loans then ran t-test
rejected_shorter <- subset(loan_df, trimws(loan_status) == "Rejected" & loan_term <= 10)
rejected_longer <- subset(loan_df, trimws(loan_status) == "Rejected" & loan_term > 10)
#Overall loan term frequency distribution
ggplot(loan_df, aes(x = factor(loan_term))) + geom_bar(fill = "#7B3D91") + labs(title = "Frequency Distribution of Loan Terms", x = "Loan Term (Years)", y = "Frequency")
#boxplot
boxplot(
rejected_shorter$cibil_score,
rejected_longer$cibil_score,
names = c("Shorter (<= 10 yrs)", "Longer (> 10 yrs)"),
main = "CIBIL Score Distribution for Rejected Loans",
ylab = "CIBIL Score",
xlab = "Loan Term Group",
col = c("#A769C2", "#87BDCC")  # add your custom colors here
)
#removing outliers
removeOutliers <- function(x) {Q1 <- quantile(x, 0.25)
Q3 <- quantile(x, 0.75);
IQR_val <- Q3 - Q1;
lower_bound <- Q1 - (1.5 * IQR_val);
upper_bound <- Q3 + (1.5 * IQR_val);
return(x[x >= lower_bound & x <= upper_bound]);}
cleaned_shorter_cibil <- removeOutliers(rejected_shorter$cibil_score)
cleaned_longer_cibil <- removeOutliers(rejected_longer$cibil_score)
t.test(rejected_shorter$cibil_score, rejected_longer$cibil_score)
t.test(cleaned_shorter_cibil, cleaned_longer_cibil)
#correlation coefficient
corr_r <- cor(loan_df[trimws(loan_df$loan_status) == "Approved", "cibil_score"], loan_df[trimws(loan_df$loan_status) == "Approved", "loan_term"], method = "pearson")
#correlation test
cor.test(loan_df[trimws(loan_df$loan_status) == "Approved", "cibil_score"], loan_df[trimws(loan_df$loan_status) == "Approved", "loan_term"], method = "pearson")
#scatter plot
ggplot(subset(loan_df, trimws(loan_status) == "Approved"), aes(x = loan_term, y = cibil_score)) + geom_point(alpha = 0.4, color = "#AAE5D8") + geom_smooth(method = "lm", se = FALSE, color = "#061411") + labs(title = "CIBIL Score vs. Loan Term for Approved Loans", x = "Loan Term (Years)", y = "CIBIL Score")
ggplot(loan_df, aes(x = self_employed, fill = loan_status)) +
geom_bar(position = "dodge") +
labs(
title = "Loan Approval by self employment status",
x = "self employment status",
y = "Number of Applicants"
) +
scale_fill_manual(values = c(" Approved" = "#F2764E", " Rejected" = "#FAF487")) +
theme_minimal()
contable <- table(loan_df$self_employed, loan_df$loan_status)
chisq.test(contable)
ggplot(loan_df, aes(x = no_of_dependents, fill = loan_status)) +
geom_bar(position = "dodge") +
labs(
title = "Loan Approval by Number of Dependents",
x = "Number of Dependents",
y = "Number of Applicants"
) +
scale_fill_manual(values = c(" Approved" = "#0D0942", " Rejected" = "#C4C0F6")) +
theme_minimal()
contable <- table(loan_df$no_of_dependents, loan_df$loan_status)
chisq.test(contable)
ggplot(loan_df, aes(x = loan_status, y = loan_term, fill = loan_status)) +
geom_boxplot(alpha = 0.6) +
labs(
title = "Loan Term by Loan Approval Status",
x = "Loan Status",
y = "Loan Term (Years)"
) +
scale_fill_manual(values = c(" Approved" = "#98C25F", " Rejected" = "#EB3BA7")) +
theme_minimal()
t.test(loan_term ~ loan_status, data = loan_df, tail="greater")
data_kmeans <- loan_df[, c("income_annum", "loan_amount", "cibil_score", "residential_assets_value", "commercial_assets_value", "luxury_assets_value", "bank_asset_value")]
cor(data_kmeans)
str(loan_df)
loan_df$combined_asset_value <- rowSums(
loan_df[, c("residential_assets_value",
"commercial_assets_value",
"luxury_assets_value",
"bank_asset_value")],
na.rm = TRUE
)
data_kmeans <- loan_df[, c("loan_amount", "combined_asset_value", "cibil_score", "income_annum")]
str(data_kmeans)
data_kmeans_scaled <- scale(data_kmeans)
wss <- sapply(1:10, function(k){
kmeans(data_kmeans_scaled, k, nstart = 20)$tot.withinss
})
plot(1:10, wss, type = "b",
xlab = "Number of clusters (k)",
ylab = "Total within-cluster sum of squares")
set.seed(123)
k <- 2
km <- kmeans(data_kmeans_scaled, centers = k, nstart = 25)
library(cluster)
sil <- silhouette(km$cluster, dist(data_kmeans_scaled))
mean(sil[, 3])
# df_scaled already contains cluster labels
df_scaled <- as.data.frame(data_kmeans_scaled)
df_scaled$cluster <- factor(km$cluster)
# -----------------------
# 1. Add cluster labels to ORIGINAL data
# -----------------------
df_unscaled <- data_kmeans      # original (unscaled) data
df_unscaled$cluster <- factor(km$cluster)
# -----------------------
# 2. Compute cluster profiles using unscaled values
# -----------------------
cluster_profiles_unscaled <- df_unscaled %>%
group_by(cluster) %>%
summarise(
loan_amount = mean(loan_amount),
cibil_score = mean(cibil_score),
income_annum = mean(income_annum),
combined_asset_value = mean(combined_asset_value)
)
print(cluster_profiles_unscaled)
library(caret)
library(e1071)
# Combine original features with cluster labels
cluster_data <- df_unscaled   # df_unscaled already includes: loan_amount, combined_asset_value, cibil_score, income_annum, cluster
set.seed(123)
# 80/20 train-test split (stratified by cluster)
index <- createDataPartition(cluster_data$cluster, p = 0.8, list = FALSE)
train_data <- cluster_data[index, ]
test_data  <- cluster_data[-index, ]
table(cluster_data$cluster)    # Check class balance
svm_model <- svm(
cluster ~ loan_amount + combined_asset_value + cibil_score + income_annum,
data = train_data,
kernel = "radial",
class.weights = table(cluster_data$cluster) / nrow(cluster_data)
)
predictions <- predict(svm_model, newdata = test_data)
confusion_matrix <- table(predictions, test_data$cluster)
print(confusion_matrix)
accuracy <- sum(diag(confusion_matrix)) / sum(confusion_matrix)
print(paste("Accuracy:", accuracy))
